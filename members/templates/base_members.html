<!doctype html>
<html lang="en">
  <head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.0/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-KyZXEAg3QhqLMpG8r+8fhAXLRk2vvoC2f3B09zVXn8CA5QIVfZOJ3BCsw2P0p/We" crossorigin="anonymous">

    <title>{% block title %}ANEMOWEN AIR QUALITY{% endblock %}
    </title>
  </head>
  <body>
    <script>
      class Widget {
        constructor(id, clsName, styles, txt) {
          this.div = document.createElement('div');
          this.type = 'Widget';
          this.div.id = id;
          this.childList = [];
          clsName != null ? this.div.className = clsName : '';
          styles != null ? styles.forEach(d => this.div.style[Object.keys(d)]=Object.values(d)) : '';
          txt != null ? this.div.innerText = txt : '';
        }
        getType() {return this.type};
        getID() {return this.div.id};
        addText(txtType, txt, styles) {
          this.text = document.createElement(txtType);
          this.text.innerText = txt; 
          styles != null ? styles.forEach(d => this.text.style[Object.keys(d)]=Object.values(d)) : '';
          this.div.append(this.text);
        }
        addBorder(styles) {
          this.div.style.border = styles;
        }
        addList(txtType, txt, styles) {
          txt.forEach(d => {
            const node = document.createElement(txtType);
            node.appendChild(document.createTextNode(d));
            styles != null ? styles.forEach(d => node.style[Object.keys(d)]=Object.values(d)) : '';
            this.div.append(node);
          }); 
        }
        addChildDiv(id, clsName, styles, txt, divType='div') {
          this.childDiv = document.createElement(divType);
          this.childDiv.id = id;
          clsName != null ? this.childDiv.className = clsName : '';
          styles != null ? styles.forEach(d => this.childDiv.style[Object.keys(d)]=Object.values(d)) : '';
          txt != null ? this.childDiv.innerHTML = txt : '';
          this.div.append(this.childDiv);
        }
        addLastChild(id, clsName, styles, txt) {
          let lastChild = document.createElement('div');
          lastChild.id = id;
          clsName != null ? lastChild.className = clsName : '';
          styles != null ? styles.forEach(d => lastChild.style[Object.keys(d)]=Object.values(d)) : '';
          txt != null ? lastChild.innerHTML = txt : '';
          this.childList.length != 0 ? this.childList[this.childList.length - 1].append(lastChild): this.div.append(lastChild);
          this.childList.push(lastChild);
        }
        addLastChildText(id, clsName, styles, txt, divType='div') {
          let lastChild = document.createElement(divType);
          lastChild.id = id;
          clsName != null ? lastChild.className = clsName : '';
          styles != null ? styles.forEach(d => lastChild.style[Object.keys(d)]=Object.values(d)) : '';
          txt != null ? lastChild.innerHTML = txt : '';
          this.childList.length != 0 ? this.childList[this.childList.length - 1].append(lastChild): this.div.append(lastChild);
          this.childList.push(lastChild);
        }
      };

      const summaryCards = (data) => {
        const cCol = new Widget('','col',[],'');
        const gridRow = document.querySelector('#gridRow');
        const card = new Widget('','card bg-primary text-white mt-5', [{'width':'400px'}, {'background-image': (`linear-gradient(to right, rgba(255,0,0,0), rgba(0,255,0,.7 ) `)}], '');
        card.addChildDiv('','card-header',[],data[1],);
        const cardT = new Widget('','card-body',[],'');
        cardT.addLastChildText('','card-title',[], data[0],'H1');
        cardT.addChildDiv('','card-text',[],data[2],'P');
        card.div.appendChild(cardT.div);
        cCol.div.appendChild(card.div);
        gridRow.appendChild(cCol.div);
      }
      const getAQIcolor = (AQI) => {
        const AQIcolor = (AQI<=50) ? "#29c402" : (AQI<=100) ? "#decc00" : (AQI<=200) ? "#f5b914" : (AQI<=250) ? "#ff3c19" : (AQI<=300) ? "#ff0019" : 
        (AQI<=400) ? "#b30000" : (AQI>500) ? "#5c0000" : "grey";
        return AQIcolor;
      };
      function hexToRGB(hex, alpha) {
        const r = parseInt(hex.slice(1, 3), 16), g = parseInt(hex.slice(3, 5), 16), b = parseInt(hex.slice(5, 7), 16);
        if (alpha) {
            return "rgba(" + r + ", " + g + ", " + b + ", " + alpha + ")";
        } else {
            return "rgb(" + r + ", " + g + ", " + b + ")";
        }
      }
      const stationCards = (data, divID,color) => {
        const rgbaColor = hexToRGB(color, 0), rgbaColor1 = hexToRGB(color, .6);
        const cCol = new Widget('','col',[],'');
        const card = new Widget('','card bg-light mb-0 mt-2 ', [{'width':'260px'},  ], '');
        card.addLastChildText('','card-header',[{'background-image': (`linear-gradient(to right, rgba(255,0,0,0), ${rgbaColor1}`)}, {'text-align':'left'}],data.properties.ID,'div');
        card.addChildDiv('','card-title',[{'text-align':'left'},{'margin-left':'12px'},{'margin-top':'5px'},{'margin-bottom':'0px'}, {'background': 'floralwhite'}],data.properties.label,'H4');
        const cBody = new Widget('','card-body', [{'text-align': 'left'}, {'background': 'floralwhite'}], '');
        cBody.addChildDiv('','card-text', [], (`PM2.5 is <b>${data.properties.PM2_5Value}</b> with an AQI of <b>${data.properties.AQI}</b> 
          The Air Qualiy is <b>${data.properties.AQIText}</b>.</br><b>${data.properties.dayHourMinSecSinceSeen}</b> d/h/m/s since active `),'p');
        cBody.addChildDiv('','card-text text-muted', [], (`1 hr PM2.5 <b>${data.properties.PM2_5_1hour}</b> and 1 hr AQI <b>${data.properties.AQI1Hour}</b></br>
          24 hr PM2.5 <b>${data.properties.PM2_5_24hour}</b> and 24 hr AQI <b>${data.properties.AQI24Hour}</b></br>
          Lon, Lat (<b>${data.geometry.coordinates}</b>)`),'small');
        card.div.appendChild(cBody.div);
        cCol.div.appendChild(card.div);
        document.querySelector(`#${divID}`).appendChild(cCol.div);
     } 
  
    
    </script>
    
    <nav class="navbar navbar-expand-lg navbar-dark" style="background: linear-gradient(to right, rgb(95, 195, 245,1), rgb(95, 195, 245,.6));">
        <div class="container-fluid">
          <a class="navbar-brand" href="{% url 'landing' %}">ANEMOWEN AIR QUALITY</a>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
          </button>
          <div class="collapse navbar-collapse" id="navbarSupportedContent">
            <ul class="navbar-nav me-auto mb-2 mb-lg-0">
              {% if user.is_authenticated %}
                <li class="nav-item">
                  <a class="nav-link" href="{% url 'sensor-dashboard' %}">Air Quality Dashboard</a>
                </li>            
              
                <li class="nav-item">
                  <a class="nav-link" href="{% url 'logout' %}">Logout</a>
                </li>
                <li class="nav-item">
                  <a class="nav-link" href="{% url 'user-edit' %}">MySensor</a>
                </li>
                <li class="nav-item">
                  <a class="nav-link" href="#">AirShare</a>
                </li>
                <li class="nav-item">
                  <a class="nav-link" href="#">Request a Test/Sensor</a>
                </li>
              
              {% else %}
              <li class="nav-item">
                <a class="nav-link" href="{% url 'sensor-dashboard' %}">Air Quality Dashboard</a>
              </li>            
                <li class="nav-item">
                  <a class="nav-link" href="{% url 'register' %}">Register</a>
                </li>
                <li class="nav-item">
                  <a class="nav-link" href="{% url 'login' %}">Login</a>
                </li>
              
              {% endif %}
            </ul>
            
          </div>
        </div>
      </nav>  
    <div id="container" class="position-relative overflow-hidden " style="height:100vh; background: linear-gradient(rgb(95, 195, 245,.4), rgb(95, 120, 245,.4), rgb(145, 95, 245,.4), rgba(220, 95, 245, 0.4));">
      {% block content %}

      {% endblock %}
      <br/><br/><a href="{% url 'landing' %}" class="btn btn-secondary">Home</a><br/><br/>
    <div class="container">
    <span class="text-muted">
      <a class="text-muted" href="https://nhbp-nsn.gov/environmental/">NHBP Mnoki Nenyak</a>
      <a class="text-muted" href="https://nhbp-nsn.gov/">NHBP</a>
      <a class="text-muted" href="https://storymaps.arcgis.com/collections/2f9f61b09e5b4860b527eff83cc08fb4">StoryMaps</a>   
      <a class="text-muted" href="https://nhbptribe.maps.arcgis.com/apps/dashboards/0380b371a3174bd8b2edae17a6d8f30c">NIBI Water Dashboard</a>
    </span>
  </div>
    </div>

    <!-- Option 1: Bootstrap Bundle with Popper -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.0/dist/js/bootstrap.bundle.min.js" integrity="sha384-U1DAWAznBHeqEIlVSCgzq+c9gqGAJn5c/t99JyeKa9xxaYpSvHU5awsuZVVFIhvj" crossorigin="anonymous"></script>

  </body>
</html>